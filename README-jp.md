# YAD80 - Yet Another Disassembler for Z80

## はじめに

yad80 は Python で記述された Z80 逆アセンブラで、次のいずれかの方法で逆アセンブルします。


## 仕様

### 入力

- アドレス情報を持たない機械語ファイル（以降 「bin ファイル」）
- アドレス情報を持つ、拡張子 `.mzt` を持つファイル（以降 「mzt ファイル」）

### 出力

逆アセンブル結果はアセンブル可能なソーステキストとして、標準出力へ出力します。<br>
出力は z88dk のアセンブラでアセンブル可能となることを確認しています。その他のアセンブラとの互換性は未確認です。

### 逆アセンブル方法

`--eager` オプションの指定の有無によって逆アセンブル方法が異なります。


| オプション指定 | 逆アセンブル方法 |
| --         | --               |
| なし（not eager）| 指定アドレスから指定行数分、逆アセンブルします。 |
| あり（eager）| 指定アドレス（複数指定可）から全分岐先を辿って逆アセンブルします。入力ファイルの範囲内で辿れなかった個所はデータとして(`DB`)で定義し、出力します。|

次のオペコードを分岐とみなします。

- `JR`
- `JP`
- `DJNZ`
- `CALL`

### 利用可能なオプション

```
usage: yad80 [-h] [--data] [--code [RANGE ...]] [--string [RANGE ...]] [--addr [ADDR ...]] [--eager] [--max-lines N]
             [--offset OFFSET]
             FILE
```

<style>
table:first-child tr td:nth-child(2) {
    color: blue;
    font-family: consolas, monotype
}
</style>
| オプション | 説明 | eager | 非eager |
| --         | --   | :--:  | :--:    |
|  -h, --help          | ヘルプの表示 | - | - |
|  --data, -d          | 未実装       | - | - |
|  --code [RANGE ...],-c [RANGE ...] | コード範囲の指定| - | &#x2713; |
|  --string [RANGE ...], -s [RANGE ...] | 文字列範囲の指定 |  &#x2713; | &#x2713; |
|  --addr [ADDR ...], -a [ADDR ...] | 逆アセンブルの開始アドレスの指定 | &#x2713; | &#x2713; |
|  --eager, -e         | eager モードの逆アセンブルを指定 | &#x2713; | |
|  --max-lines N, -m N | eager モードでない逆アセンブル時、逆アセンブルする行数を指定| | &#x2713; |
|  --offset OFFSET, -o OFFSET | ファイルの先頭が 0 番地でない場合にそのアドレスを指定する | &#x2713; | &#x2713; |

- 範囲は 先頭アドレスを末尾アドレスを `-` で結合して指定します。複数の範囲を指定することができます<br>例）`-c 40-47`
- 開始アドレスが複数指定された場合は eager モードかどうかで次のように動作します。
    - eager あり: 指定されたアドレスを全て分岐先として逆アセンブル
    - eager なし: 最初に指定されたアドレスから逆アセンブル
- 開始アドレスが指定されなかった場合、MZT ファイルではヘッダ内の開始アドレスから、BIN ファイルではファイル先頭のアドレスが指定されたものとして動作します。
-- 〇〇オプションを指定した場合、対象ファイルとの間にオプション終了の区切り `--` を指定してください。<br>例） `python -m yad80 -e -a 41 42 43 -- NEWMONITOR7.ROM`



                        address range(a1-a2) as code. a2 is an inclusive address
                        address range(a1-a2) as code. a2 is an inclusive address

    - `JR`, `JP`, `CALL`

## オプション

## 使用例
